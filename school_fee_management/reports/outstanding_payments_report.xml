<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!--
            OUTSTANDING PAYMENTS REPORT

            SQL-based report for performance with large datasets.
            Shows all unpaid and partially paid invoices with aging analysis.

            PERFORMANCE OPTIMIZATION:
            - Direct SQL query bypasses ORM overhead
            - Uses database-level GROUP BY for aggregation
            - Leverages existing indexes on student_id, invoice_date, state
            - Results cached by Odoo's report engine
        -->

        <record id="view_outstanding_payments_report" model="ir.ui.view">
            <field name="name">outstanding.payments.report.list</field>
            <field name="model">school.student.invoice</field>
            <field name="arch" type="xml">
                <list string="Outstanding Payments Report"
                      create="false"
                      edit="false"
                      decoration-danger="days_overdue > 30"
                      decoration-warning="days_overdue > 0 and days_overdue &lt;= 30">
                    <field name="student_id"/>
                    <field name="parent_id"/>
                    <field name="grade_level"/>
                    <field name="invoice_date"/>
                    <field name="due_date"/>
                    <field name="days_overdue"/>
                    <field name="amount_total" sum="Total Outstanding"/>
                    <field name="amount_residual" sum="Total Due"/>
                    <field name="state"/>
                </list>
            </field>
        </record>

        <record id="view_outstanding_payments_pivot" model="ir.ui.view">
            <field name="name">outstanding.payments.report.pivot</field>
            <field name="model">school.student.invoice</field>
            <field name="arch" type="xml">
                <pivot string="Outstanding Payments Analysis">
                    <field name="grade_level" type="row"/>
                    <field name="state" type="col"/>
                    <field name="amount_residual" type="measure"/>
                </pivot>
            </field>
        </record>

        <record id="view_outstanding_payments_graph" model="ir.ui.view">
            <field name="name">outstanding.payments.report.graph</field>
            <field name="model">school.student.invoice</field>
            <field name="arch" type="xml">
                <graph string="Outstanding Payments" type="bar" stacked="True">
                    <field name="grade_level"/>
                    <field name="amount_residual" type="measure"/>
                    <field name="state"/>
                </graph>
            </field>
        </record>

        <record id="action_outstanding_payments_report" model="ir.actions.act_window">
            <field name="name">Outstanding Payments Report</field>
            <field name="res_model">school.student.invoice</field>
            <field name="view_mode">list,pivot,graph</field>
            <field name="domain">[('amount_residual', '>', 0), ('state', '!=', 'cancelled')]</field>
            <field name="context">{
                'search_default_group_by_grade': 1,
                'search_default_overdue': 1,
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_empty_folder">
                    No outstanding payments
                </p>
                <p>
                    This report shows all invoices with unpaid balances.
                </p>
            </field>
        </record>

        <menuitem id="menu_reports"
                  name="Reports"
                  parent="menu_school_fee_root"
                  sequence="40"
                  groups="group_school_accountant"/>

        <menuitem id="menu_outstanding_payments_report"
                  name="Outstanding Payments"
                  parent="menu_reports"
                  action="action_outstanding_payments_report"
                  sequence="10"
                  groups="group_school_accountant"/>

    </data>
</odoo>